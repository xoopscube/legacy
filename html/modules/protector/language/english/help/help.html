<div data-layout="row sm-column">

    <div data-self="size-xxsmall">
        <nav id="help-menu">
            <ul data-layout="rows">
                <li><a href="#help-overview" class="button">Protector Module</a>
                <li><a href="#help-csp" class="button">Content Security Policy</a>
                <li><a href="#help-blacklist" class="button">IP Blacklist</a>
                <li><a href="#help-httpbl" class="button">HTTP:BL Settings</a></li>
                <li><a href="#help-session" class="button">Session Hijacking</a>
                <li><a href="#help-dos" class="button">DoS</a>
                <li><a href="#help-crawler" class="button">Bad Crawlers</a>
                <li><a href="#help-sql" class="button">SQL Injection</a>
                <li><a href="#help-xss" class="button">XSS</a>
                <li><a href="#help-var" class="button">Global Variables</a>
                <li><a href="#help-proxy" class="button">Proxy</a></li>
                <li><a href="#help-development" class="button">Development</a>
            </ul>
        </nav>
    </div>

<article id="help-module">

    <section id="help-overview">

        <h3>Overview</h3>

        <p>The module Protector module can defend your site against most common attacks.

        <ul>
            <li>Denial of service (DOS) attacks, bandwidth-hungry crawlers and spambots.
            <li>SQL injection, variable contamination, null bytes, session hijacking, etc.
            <li>Brute force attacks and directory traversals.
            <li>Uploading of camouflaged image files and executables.
            <li>Link and comment spammers
        </ul>
        <p>Protector logs the attacking IPs and offers a range of countermeasures including IP bans, disable access, hidden the website response and automatic sanitization of attempted injections.
        <p>The module also provides warnings of certain vulnerabilities in third-party add-ons and advices to fix them in the section <b>Security Advisor</b>.
        <p>You can define security settings and rules to a more strict web security policy mechanism.
        <p>Protector is a module developed by the trusted developer Gijoe from https://peak.ne.jp
        <p>This module is widely considered by module developers as well as other CMS as a "must have" module.

    </section>

    <!-- Todo: write documentation to help configure CSP, a short summary, and a paragraph for each config and ul list for options -->
    <section id="help-csp">

        <h3>Content Security Policy (CSP)</h3>

        <p>Content Security Policy (CSP) is a powerful security feature that helps prevent Cross-Site Scripting (XSS) and other code injection attacks. It works by specifying which content sources are considered trusted, and instructing the browser to only execute or render resources from those trusted sources.</p>
        
        <p>When enabled, CSP acts as an additional layer of defense by restricting what resources can be loaded on your pages. This significantly reduces the risk of XSS vulnerabilities even if they exist in your site's code.</p>
        
        <h4>Key Benefits:</h4>
        <ul>
            <li>Mitigates XSS attacks by controlling which scripts can execute</li>
            <li>Prevents unwanted content injection</li>
            <li>Protects against clickjacking and frame injection</li>
            <li>Provides detailed violation reports to help identify potential security issues</li>
            <li>Reduces the attack surface of your website</li>
        </ul>
        
        <h4>Configuration Options:</h4>
        
        <p><strong>Enable Content Security Policy</strong> - Activates the CSP protection for your site. When enabled, the system will add appropriate CSP headers to all responses.</p>
        
        <p><strong>Add CSP Meta Tag Support</strong> - Adds CSP as a meta tag in addition to HTTP headers for compatibility with older browsers that don't support CSP headers.</p>
        
        <p><strong>Default Sources</strong> - Controls the default policy for loading content such as JavaScript, Images, CSS, Fonts, AJAX requests, and Frames. The default value <code>'self'</code> allows resources to be loaded only from the same origin.</p>
        <ul>
            <li><code>'self'</code> - Allow resources from the same origin</li>
            <li><code>'none'</code> - Block all resources of this type</li>
            <li><code>example.com</code> - Allow resources from specific domains</li>
            <li><code>*.example.com</code> - Allow resources from all subdomains</li>
        </ul>
        
        <p><strong>Script Sources</strong> - Defines valid sources for JavaScript. This is one of the most important directives for security.</p>
        <ul>
            <li><code>'self'</code> - Allow scripts from the same origin</li>
            <li><code>'unsafe-inline'</code> - Allow inline scripts (reduces security but may be necessary for compatibility)</li>
            <li><code>'unsafe-eval'</code> - Allow the use of eval() and similar methods (reduces security)</li>
            <li><code>https://trusted-cdn.com</code> - Allow scripts from specific external sources</li>
        </ul>
        
        <p><strong>Style Sources</strong> - Defines valid sources for stylesheets or CSS.</p>
        <ul>
            <li><code>'self'</code> - Allow styles from the same origin</li>
            <li><code>'unsafe-inline'</code> - Allow inline styles (often needed for compatibility)</li>
            <li><code>https://fonts.googleapis.com</code> - Allow styles from external sources like Google Fonts</li>
        </ul>
        
        <p><strong>Image Sources</strong> - Defines valid sources for images.</p>
        <ul>
            <li><code>'self'</code> - Allow images from the same origin</li>
            <li><code>data:</code> - Allow data: URIs for images (commonly used for small inline images)</li>
            <li><code>https:</code> - Allow images from any HTTPS source</li>
        </ul>
        
        <p><strong>Connect Sources</strong> - Defines valid sources for fetch, XMLHttpRequest, WebSocket, and EventSource connections.</p>
        <ul>
            <li><code>'self'</code> - Allow connections to the same origin</li>
            <li><code>https://api.example.com</code> - Allow connections to specific API endpoints</li>
        </ul>
        
        <p><strong>Font Sources</strong> - Defines valid sources for web fonts.</p>
        <ul>
            <li><code>'self'</code> - Allow fonts from the same origin</li>
            <li><code>https://fonts.gstatic.com</code> - Allow fonts from services like Google Fonts</li>
            <li><code>data:</code> - Allow data: URIs for fonts</li>
        </ul>
        
        <p><strong>Object Sources</strong> - Defines valid sources for plugins like &lt;object&gt;, &lt;embed&gt;, and &lt;applet&gt; elements.</p>
        <ul>
            <li><code>'self'</code> - Allow objects from the same origin</li>
            <li><code>'none'</code> - Block all plugins (recommended for security)</li>
        </ul>
        
        <p><strong>Media Sources</strong> - Defines valid sources for &lt;audio&gt;, &lt;video&gt;, and &lt;track&gt; elements.</p>
        <ul>
            <li><code>'self'</code> - Allow media from the same origin</li>
            <li><code>https://media.example.com</code> - Allow media from specific sources</li>
        </ul>
        
        <p><strong>Frame Sources</strong> - Defines valid sources for frames and iframes.</p>
        <ul>
            <li><code>'self'</code> - Allow frames from the same origin</li>
            <li><code>'none'</code> - Block all frames (high security)</li>
            <li><code>https://youtube.com https://player.vimeo.com</code> - Allow frames from specific services</li>
        </ul>
        
        <p><strong>Report URI</strong> - URI to which the browser sends reports about policy violations. This can help you identify and fix potential issues.</p>
        <ul>
            <li>Example: <code>/modules/protector/csp-report.php</code></li>
            <li>You can also use third-party CSP reporting services</li>
        </ul>
        
        <h4>Implementation Notes:</h4>
        <ul>
            <li>Start with strict policies and relax them as needed based on functionality requirements</li>
            <li>Use the report-only mode initially to identify potential issues without breaking functionality</li>
            <li>Test thoroughly after implementing CSP as it may affect third-party modules and themes</li>
            <li>Consider using nonces or hashes instead of 'unsafe-inline' for better security</li>
            <li>Review CSP reports regularly to identify potential security issues</li>
        </ul>
        
        <p>For more information about Content Security Policy, visit the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" target="_blank">Mozilla Developer Network</a>.</p>

    </section>


    <section id="help-blacklist">

        <h3>IP Blacklist</h3>

        <p>What Is IP Blacklisting?
        <p>IP blacklisting is a method used to filter out the illegitimate or malicious IP addresses from accessing your networks.
        <p>Blacklists are lists containing ranges or individual IP addresses that you want to block.
        <p>You can use these lists in combination with firewalls, intrusion prevention systems (IPS), and other traffic filtering tools.
        <p>Creating and applying blacklists enables you to filter malicious traffic according to policies or through the manual
        addition of IP addresses.
        <p>Many network security tools that use blacklists are also able to add new addresses to be blocked.
        <p>This can be done as externally referenced lists are updated or according to the results of event analysis.</p>

    </section>

    <section id="help-httpbl">
        <!-- Start documentation on usage of HTTP:BL Settings using html tags <h3>, <p>, <ul>, <li> -->
           
            <h3>HTTP:BL Settings</h3>
            <p>HTTP:BL (HTTP BlackList) is a service provided by Project Honey Pot that helps identify and block malicious web requests. It allows you to check if an IP address is known for suspicious activities before processing requests from that IP.</p>
            
            <p>To use HTTP:BL with Protector, you need to:</p>
            
            <ul>
                <li>Sign up for a free API key at <a href="https://www.projecthoneypot.org/" target="_blank">Project Honey Pot</a></li>
                <li>Enter your API key in the Protector module's "Threat Intelligence" settings</li>
                <li>Configure the threat threshold to determine how aggressive the filtering should be</li>
            </ul>
            
            <p>HTTP:BL provides information about IP addresses including:</p>
            
            <ul>
                <li>Threat score (0-255, higher means more dangerous)</li>
                <li>Visitor type (search engine, suspicious, harvester, comment spammer)</li>
                <li>Last seen (how many days since this IP was last reported)</li>
            </ul>
            
            <p>When enabled, Protector will check visitor IPs against the HTTP:BL database and take action based on your configured settings. This adds an additional layer of protection against known malicious actors.</p>
    
            <!-- End documentation on usage of HTTP:BL Settings-->

    </section>

    <section id="help-session">

        <h3>Session Hijacking</h3>

        <p>The Session Hijacking attack consists of the exploitation of the web session control mechanism, which is normally managed for a session token.

        <p>Because http communication uses many TCP connections, the web server needs a method to recognize every user‚Äôs connections.
            The most useful method depends on a token that the Web Server sends to the client browser after a successful client authentication.
            A session token is normally composed of a string of variable width and it could be used in different ways,
            like in the URL, in the header of the http requisition as a cookie, in other parts of the header of the http request, or yet in the body of the http requisition.

        <p>The Session Hijacking attack compromises the session token by stealing or predicting a valid session token to gain unauthorized access to the Web Server.

        <p>The session token could be compromised in different ways; the most common are:

            <ul>
                <li>Predictable session token
                <li>Session Sniffing
                <li>Client-side attacks (XSS, malicious JavaScript Codes, Trojans, etc)
                <li>Man-in-the-middle attack
                <li>Man-in-the-browser attack
            </ul>

    </section>


    <section id="help-dos">

        <h3>Denial of Service (DoS)</h3>

        <p>DoS attack attempts to saturate the abilities of a server
        <p>The classic typology of DoS attack consists in the continuous loading of portal portions,
            forcing the server into continually working to satisfy the demands
        <p>How the module reacts - Protector can estimate the frequency of requests to the same pages, through time and number of reloads.
        Once it matchs a pattern of the DoS attack, it can react with the following options :

        <ul>
            <li>logging the IP of the attacker
            <li>prevent access to pages containing the block "Login"
            <li>disable access or hidden the website response
            <li>blank response from server (blank page)
        </ul>

        <p>Protector can also automatically add the IP to the directory of excluded IP addresses (therefore banning the IP)

        <p>Moreover in the recent versions of the module it is possible to deny the access to the website through the use of the htaccess file
        (even if this functionality is still at the experimental level).

        <p>Some modules, for example the live chat module, are frequently updated by the users' browser to follow
        the continuous flow of information that is modified.
        In order to prevent users from using such modules as indicated for an attack, it is possible to define which modules escape anti-DoS control.

    </section>


    <section id="help-crawler">

        <h3>Bad Crawlers</h3>

        <p>A crawler is an indexing motor and information collector (for example an email sender in a forum spamming)
        <p>It is considered a <b>bad crawler</b> when too frequently request are carried out.
        <p>Protector reacts by applying the same criteria of DoS to the <b>bad crawler</b> and provides the following options :

        <ul>
            <li>show only a page containing the login block
            <li>disable access, hidden the website response
            <li>blank response from server (blank page)
            <li>banning the IP
            <li>block from .htaccess (experimental)
        </ul>

    </section>


    <section id="help-sql">

        <h3>SQL Injection</h3>

        <p>SQL injection is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database.
            Such code injection technique might destroy your database. SQL injection is one of the most common web hacking techniques.
        <p>Protector can react by blocking various types of SQL injection attacks:

        <ul>
            <li>monitoring and surveillance
            <li>prevent attempts in isolated comments
            <li>monitoring the syntax of union operator in SQL
            <li>prevent invalid data from being inserted into fields key
        </ul>

        <p>Important actions are audited (security, queries, executes, logins, etc.) and Protector can react in the following ways:

        <ul>
            <li>show only a page containing the login block
            <li>data sanitization before sending it to the database
            <li>blank response from server (blank page)
            <li>banning the IP
        </ul>
        <p>Protector sanitizes the input before sending it to the database. Thus, parameterized queries can prevent SQL injection.

    </section>


    <section id="help-xss">

        <h3>Cross-Site Scripting (XSS)</h3>

        <p>These attacks are a type of injection, in which malicious scripts are injected into otherwise benign third-party add-ons of websites.
        <p>XSS attacks occur when an attacker uses an third-party add-on installed in the web application to send malicious code,
        generally in the form of a browser side script, to a different end user.
        <p>Flaws that allow these attacks to succeed are quite widespread and occur anywhere an input from a user generates an output without validation or encoding.
        <p>It is recommended to install add-ons tested and stable, developed by a trusted developers recognized for reliability and competence.

        <p>Protector, being in fact a particularly powerful module itself, can only intercept part of these attacks by sanitizing data (see SQL injection attacks).

    </section>


    <section id="help-var">

    <h3>Contamination of Global Variables</h3>

    <p>A malicious attack can override variables leveraging user-supplied, untrusted query variables directly used on the
        application server without any data sanitization. In extreme cases, the attack can change variables controlling
        the business logic of the application. For instance, in languages like PHP, a number of poorly set default configurations
        may allow the user to override variables.</p>
    <p>Protector can react in the following ways:

    <ul>
        <li>show only a page containing the login block
        <li>landing page
        <li>banning the IP
    </ul>

    </section>

    <section id="help-proxy">

        <h3>Web HTTP Proxy</h3>
        
        <p>The Web HTTP Proxy feature provides secure access to external resources while protecting your site from malicious content. When enabled, it acts as an intermediary between your users and external websites.</p>
        
        <h4>Key Features:</h4>
        <ul>
            <li>Content filtering and sanitization</li>
            <li>URL rewriting to maintain proxy connections</li>
            <li>Caching of proxied content for improved performance</li>
            <li>Detailed logging of proxy requests</li>
            <li>Plugin system for extending functionality</li>
        </ul>
        
        <h4>Configuration Options:</h4>
        <ul>
            <li><strong>Allowed Domains</strong> - Specify which domains can be accessed through the proxy</li>
            <li><strong>Blocked Domains</strong> - Specify domains that should never be accessible</li>
            <li><strong>Cache Settings</strong> - Enable caching and set cache duration</li>
            <li><strong>Security Options</strong> - Strip JavaScript, cookies, and other potentially harmful content</li>
            <li><strong>Custom User Agent</strong> - Set a specific user agent for proxy requests</li>
        </ul>
        
        <h4>Using the Proxy:</h4>
        <p>Access the proxy through: <code>yoursite.com/modules/protector/proxy.php?url=https://example.com</code></p>
        
        <h4>Creating Proxy Plugins:</h4>
        <p>Plugins allow you to extend the proxy functionality. Here's a simple example:</p>
        
        <pre><code class="lang-php">
class ProtectorProxyExamplePlugin {
    private $proxy;
    
    public function __construct($proxy) {
        $this->proxy = $proxy;
    }
    
    public function processContent($url, $content) {
        // Example: Add a banner at the top of every proxied page
        $banner = '<div style="background:#f8f9fa;padding:10px;text-align:center;">
                    Viewed through secure proxy
                   </div>';
        
        // Insert banner after the body tag
        $content = preg_replace('/<body([^>]*)>/i', 
                               '<body$1>' . $banner, 
                               $content);
        
        return $content;
    }
}
</code></pre>
        
        <p>Save your plugin as <code>example.php</code> in the <code>plugins/proxy/</code> directory and enable it in the proxy settings.</p>
        
        <p>When enabled, Protector will check the IP address of the client against the list of trusted proxies.
        If the IP address is not in the list, Protector will take action based on your configured settings.
        This adds an additional layer of protection against known malicious actors.</p>


        <h4>Proxy Plugin Example</h4>
        
        <p>Content Sanitizer Plugin for Protector Proxy is a simple plugin example, a content sanitizer plugin, that removes potentially harmful elements from proxied content. 
        This is a practical utility that demonstrates the plugin system while providing real security benefits.</p>
        <p>This plugin:</p>
        <ol>
        <li>1. Adds a clear notification banner so users know they're viewing content through a proxy</li>
        <li>2. Removes potentially harmful elements like scripts, iframes, and event handlers</li>
        <li>3. Adds CSS to prevent certain positioning tricks that could be used for clickjacking</li>
        </ol>
        <p>It's simple enough to understand but provides real value, making it an excellent first example for the proxy system.</p>

    </section>

    <section id="help-development">

        <table class="outer">
            <tbody>
            <tr>
                <td>Bundle Package</td>
                <td> XCL 2.5.0</td>
            </tr>
            <tr>
                <td>Module name</td>
                <td>Protector</td>
            </tr>
            <tr>
                <td>Type</td>
                <td>Trust Module</td>
            </tr>
            <tr>
                <td>Level</td>
                <td>Required</td>
            </tr>
            <tr>
                <td>Author</td>
                <td>Update by Nuno Luciano aka gigamaster, 2020 XCL23</td>
            </tr>
            <tr>
                <td>Author</td>
                <td>Original by Gijoe @peak.ne.jp</td>
            </tr>
            <tr>
                <td>Copyright </td>
                <td>(c) 2007-2025 Peak.ne.jp, Authors</td>
            </tr>
            <tr>
                <td>license</td>
                <td>GPL 2.0</td>
            </tr>
            <tr>
                <td>üåê Repository URL</td>
                <td><a href="https://github.com/xoopscube/protector" target="_blank">https://github.com/xoopscube/protector ‚≠ß</a></td>
            </tr>
            </tbody>
        </table>

    </section>


</article>
</div>
